<%- include("../../partials/header", { title }) %>

<%
  const isEdit = !!form?.id;
  const action = isEdit
    ? ("/admin/kost/inventory/locations/" + form.id)
    : "/admin/kost/inventory/locations";

  const activeChecked = (form && (form.is_active === true || form.is_active === "true" || form.is_active === 1 || form.is_active === "1" || form.is_active === "on"))
    ? true
    : (isEdit ? false : true);

  const currentType = (form?.location_type || "").toString().toUpperCase();
  const currentRoomId = form?.room_id ? String(form.room_id) : "";
%>

<h1 class="h3 mb-3"><%= isEdit ? "Edit Inventory Location" : "New Inventory Location" %></h1>

<% if (errors && errors.length) { %>
  <div class="alert alert-danger">
    <div class="fw-bold mb-1">Periksa input:</div>
    <ul class="mb-0">
      <% errors.forEach((e) => { %>
        <li><%= e %></li>
      <% }) %>
    </ul>
  </div>
<% } %>

<form method="POST" action="<%= action %>" class="card p-3" id="locForm">
  <div class="mb-3" id="nameWrap" style="display:none;">
    <label class="form-label">Nama Lokasi *</label>
    <input
      name="name"
      id="loc_name"
      class="form-control"
      placeholder="Contoh: Gudang Utama"
      value="<%= form?.name || "" %>"
      required
    />
    <div class="form-text" id="nameHelp"></div>
  </div>



  <div class="mb-3">
    <label class="form-label">Location Type *</label>
    <select class="form-select" name="location_type" id="location_type" required>
      <option value="">-- pilih type --</option>
      <% (locationTypes || []).forEach((t) => { %>
        <option value="<%= t %>" <%= (String(t).toUpperCase() === currentType) ? "selected" : "" %>>
          <%= t %>
        </option>
      <% }) %>
    </select>
    <div class="form-text">
      GENERAL = gudang/tempat umum, ROOM = lokasi melekat ke kamar.
    </div>
  </div>


  <div class="mb-3" id="roomWrap" style="display:none;">
    <label class="form-label">Room (wajib jika type = ROOM)</label>
    <select class="form-select" name="room_id" id="room_id">
      <option value="">- pilih room -</option>
      <% (rooms || []).forEach((r) => { %>
        <option value="<%= r.id %>" <%= (String(r.id) === currentRoomId) ? "selected" : "" %>>
          <%= r.code ? r.code : ("Room #" + r.id) %>
        </option>
      <% }) %>
    </select>
  </div>




<div class="form-check mb-3">
  <input
    class="form-check-input"
    type="checkbox"
    id="is_active"
    name="is_active"
    value="1"
    <%= activeChecked ? "checked" : "" %>
  />
  <label class="form-check-label" for="is_active">Active</label>
</div>


  <div class="d-flex gap-2">
    <button class="btn btn-primary" type="submit">Save</button>
    <a class="btn btn-outline-secondary" href="/admin/kost/inventory/locations">Cancel</a>
  </div>
</form>

<script src="/js/kost/inventory/locations-form.js" defer></script>
<%- include("../../partials/footer") %>
